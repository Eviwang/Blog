# 前端测试进阶

## 快照 

```javascript
test("快照测试",()=>{
    expect(generageConfig()).toMatchSnapshot();// 匹配和上一次的配置是否一样。
    expect(generageConfig()).toMatchSnapshot({
        time: expect.any(Date) // 表示不用值完全匹配，只要 time 类型是Date即可
    });
});
```



快照默认会放在文件夹中。

可以 调整使用   inline的方式 . 需要安装  prettier包

```javascript
expect(generateConfig()).toMatchInlineSnapshot();
```



## mock进阶 

- 利用 `__mocks__` 文件夹,在文件夹下新建一个 同名的js模块，就可以 mock 方法了

```
jest.mock("./demo");//mock这个模块，在 __mocks__文件夹下面
import {fetchData}  from './demo'

test("fetch  Data", ()=>{
    return fetchData().then(data=>{
        expect(eval()).toEqal('123');
    });
});

```

`jest.unmock("./demo");`



- 在 jest.config.js 中开启  autoMock:true 他会在 `__mocks__`中自动找这个模块

- 有时候 ，我们可能在一个模块中，有些方法需要被mock，有些不需要被mock

```javascript
const {getNumber} = jest.requireActual('./demo');//  这样getNumber就是走的不被mock的
```



## Mock Timers



```javascript
jest.useFakeTimers();// 使用 mock的  setTimeOut
test("timer", ()=>{
    const  fn =jest.fn();
    timer(fn);
    jest.runAllTimers();// 立即运行setTimeOut。【需要和useFakeTimers配对使用。】
    expect(fn).toHaveBeenCalledTimers(1);
});
```

推荐API:  jest.advanceTimersByTime(6000); 快进6秒

```javascript
jest.useFakeTimers();// 使用 mock的  setTimeOut
test("timer", ()=>{
    const  fn =jest.fn();
    timer(fn);
    jest.advanceTimersByTime(6000);// 快进6秒
    expect(fn).toHaveBeenCalledTimers(1);
});
```



## Mock  ES6中的类

```javascript
jest.mock("./util");
import  Util  from './util';

Util模块是一个类，如果使用 了jest.mock("./util")函数
表示里面的方法都是被mock的：
utils.fn1 = jest.fn();
utils.fn2 = jest.fn();

expect(Util.mock.instances[0].fn1).toHaveBeenCalled();// 函数实例被调用



```

## 单元测试和集成测试

单元是只测一个单元，比如  类中的方法。单元测试要快，所以需要mock

集成测试  指多个单元组合起来的业务一起测试，叫集成测试





## jest中对dom操作测试

jest 在node环境下，模拟了一套 dom 的api，jsDOM.所以在测试的使用 ，和使用jquery一样的

```javascript
test("",()=>{
    addDivToBody();
    expect($("body"),find("div").length).toBe(2)
});
```



